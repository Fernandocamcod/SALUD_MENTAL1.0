<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CENTRO PSICOLÓGICO DE ESPECIALIDADES</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- FAVICON - SOLUCIÓN ERROR 404 -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🧠</text></svg>">
    
    <meta name="description" content="Centro Psicológico de Especialidades - Expertos en salud mental">
    <meta name="theme-color" content="#b84a39">

    <style>
        .hero-banner {
            background: linear-gradient(rgba(184, 74, 57, 0.85), rgba(184, 74, 57, 0.75)), 
                        url('assets/images/logo-cpe.png') center/cover no-repeat;
            min-height: 80vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: white;
            padding: 2rem;
        }

        .specialty-card {
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .specialty-card:hover {
            transform: translateY(-5px);
        }

        .specialty-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-size: cover;
            background-position: center;
            opacity: 0.1;
            transition: opacity 0.3s ease;
            z-index: 1;
        }

        .specialty-card:hover::before {
            opacity: 0.2;
        }

        .specialty-card:nth-child(1)::before {
            background-image: url('assets/images/anciedad.png');
        }

        .specialty-card:nth-child(2)::before {
            background-image: url('assets/images/depresion.png');
        }

        .specialty-card:nth-child(3)::before {
            background-image: url('assets/images/terapia de parejas.png');
        }

        @media (max-width: 768px) {
            .hero-banner {
                min-height: 60vh;
            }
            
            .specialty-card::before {
                opacity: 0.05;
            }
            
            .specialty-card:hover::before {
                opacity: 0.1;
            }
        }

        @media (max-width: 480px) {
            .hero-banner {
                min-height: 50vh;
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Floating WhatsApp -->
    <a href="https://wa.me/593984001305" class="float-whatsapp" target="_blank">
        <i class="fab fa-whatsapp"></i>
    </a>

    <header class="logo-section">
        <div class="logo-container">
            <img src="assets/images/logo-cpe.png" alt="Logo Centro Psicológico" class="logo-img">
            <div class="title-container">
                <h1 class="title-main">CENTRO PSICOLÓGICO</h1>
                <p class="title-sub">DE ESPECIALIDADES</p>
            </div>
        </div>
    </header>

    <nav class="navbar">
        <div class="nav-container">
            <ul class="nav-links">
                <li><a href="#inicio" class="nav-link">INICIO</a></li>
                <li><a href="#quienes-somos" class="nav-link">QUIÉNES SOMOS</a></li>
                <li><a href="#especialidades" class="nav-link">ESPECIALIDADES</a></li>
                <li><a href="#servicios" class="nav-link">SERVICIOS</a></li>
                <li><a href="#contacto" class="nav-link">CONTACTO</a></li>
            </ul>
        </div>
    </nav>

    <main>
        <!-- Hero Section -->
        <section id="inicio" class="hero-banner">
            <div class="hero-content">
                <div class="hero-text">
                    <p class="hero-subtitle">Bienvenido a tu espacio de bienestar mental</p>
                    <h2 class="hero-title">
                        <span class="title-line">Tu salud mental</span>
                        <span class="title-line">está en buenas manos</span>
                    </h2>
                    <p class="hero-description">Contamos con profesionales especializados para acompañarte en tu proceso de crecimiento personal.</p>
                    <div class="hero-buttons">
                        <a href="#contacto" class="hero-button primary">
                            <span>Agendar Cita</span>
                            <i class="fas fa-calendar-check"></i>
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Quiénes Somos -->
        <section id="quienes-somos" class="section-container">
            <div class="section-header">
                <h2 class="section-title">QUIÉNES SOMOS</h2>
                <div class="section-divider"></div>
            </div>
            <div class="content-grid">
                <div class="text-content">
                    <div class="feature-highlight">
                        <i class="fas fa-heart"></i>
                        <h3>Misión</h3>
                        <p>Brindar servicios psicológicos de excelencia, accesibles y personalizados.</p>
                    </div>
                    <div class="feature-highlight">
                        <i class="fas fa-eye"></i>
                        <h3>Visión</h3>
                        <p>Ser el centro psicológico de referencia en el cuidado de la salud mental.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Especialidades -->
        <section id="especialidades" class="section-container">
            <div class="section-header">
                <h2 class="section-title">NUESTRAS ESPECIALIDADES</h2>
                <div class="section-divider"></div>
            </div>
            <div class="specialties-grid">
                <div class="specialty-card">
                    <div class="card-icon">
                        <i class="fas fa-brain"></i>
                    </div>
                    <h3>Ansiedad y Estrés</h3>
                    <p>Técnicas avanzadas para manejo de ansiedad y estrés crónico.</p>
                </div>
                <div class="specialty-card">
                    <div class="card-icon">
                        <i class="fas fa-sad-tear"></i>
                    </div>
                    <h3>Depresión</h3>
                    <p>Tratamiento especializado para estados depresivos.</p>
                </div>
                <div class="specialty-card">
                    <div class="card-icon">
                        <i class="fas fa-user-friends"></i>
                    </div>
                    <h3>Terapia de Pareja</h3>
                    <p>Mejora la comunicación y resolución de conflictos.</p>
                </div>
            </div>
        </section>

        <!-- Contacto -->
        <section id="contacto" class="section-container contact-section">
            <div class="section-header">
                <h2 class="section-title">AGENDA TU CITA</h2>
                <div class="section-divider"></div>
                <p class="section-subtitle">Estamos aquí para ayudarte. Toma el primer paso hacia tu bienestar.</p>
            </div>
            
            <div class="contact-container">
                <div class="contact-info">
                    <div class="info-card">
                        <div class="info-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="info-content">
                            <h4>Dirección</h4>
                            <p>Calle Principal #123, Ciudad</p>
                        </div>
                    </div>
                    <div class="info-card">
                        <div class="info-icon">
                            <i class="fas fa-phone"></i>
                        </div>
                        <div class="info-content">
                            <h4>Teléfono</h4>
                            <p>+593 98 400 1305</p>
                        </div>
                    </div>
                    <div class="info-card">
                        <div class="info-icon">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <div class="info-content">
                            <h4>Email</h4>
                            <p>williamfernando1981@gmail.com</p>
                        </div>
                    </div>
                </div>
                
                <div class="contact-form-container">
                    <form id="contactForm" class="modern-form">
                        <div class="form-group">
                            <label for="name">Nombre Completo *</label>
                            <input type="text" id="name" name="from_name" required>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="email">Email *</label>
                                <input type="email" id="email" name="from_email" required>
                            </div>
                            <div class="form-group">
                                <label for="phone">Teléfono *</label>
                                <input type="text" id="phone" name="phone" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="service">Servicio de Interés *</label>
                            <select id="service" name="service" required>
                                <option value="">Selecciona un servicio</option>
                                <option value="Terapia Individual">Terapia Individual</option>
                                <option value="Terapia de Pareja">Terapia de Pareja</option>
                                <option value="Psicología Infantil">Psicología Infantil</option>
                                <option value="Ansiedad y Estrés">Ansiedad y Estrés</option>
                                <option value="Depresión">Depresión</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="message">Mensaje / Motivo de Consulta *</label>
                            <textarea id="message" name="message" rows="5" placeholder="Describe brevemente el motivo de tu consulta..." required></textarea>
                        </div>

                        <button type="submit" class="submit-btn">
                            <span>Enviar Solicitud de Cita</span>
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </form>
                    
                    <div id="confirmationMessage" class="message-alert success" style="display: none;">
                        <i class="fas fa-check-circle"></i>
                        <div>
                            <h4>¡Mensaje Enviado!</h4>
                            <p>Tu solicitud ha sido enviada correctamente. Nos pondremos en contacto contigo en menos de 24 horas.</p>
                        </div>
                    </div>
                    
                    <div id="errorMessage" class="message-alert error" style="display: none;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div>
                            <h4>Error al Enviar</h4>
                            <p id="errorText">Ha ocurrido un error. Por favor, intenta nuevamente o contáctanos directamente por teléfono.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="modern-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Centro Psicológico de Especialidades</h3>
                <p>Tu bienestar emocional es nuestra prioridad.</p>
            </div>
            
            <div class="footer-section">
                <h4>Contacto</h4>
                <div class="contact-info-footer">
                    <p><i class="fas fa-phone"></i> +593 98 400 1305</p>
                    <p><i class="fas fa-envelope"></i> williamfernando1981@gmail.com</p>
                </div>
            </div>
        </div>
        
        <div class="footer-bottom">
            <p>&copy; 2024 Centro Psicológico de Especialidades. Todos los derechos reservados.</p>
        </div>
    </footer>

    <!-- EmailJS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    
    <!-- Script principal CON MANEJO DE ERRORES -->
    <script>
        // MANEJADOR DE ERRORES DE EXTENSIONES
        window.addEventListener('error', function(e) {
            if (e.filename && e.filename.includes('content-all.js')) {
                e.preventDefault();
                console.log('⚠️ Error de extensión ignorado - No afecta tu sitio');
                return true;
            }
        });

        // CONFIGURACIÓN EMAILJS CON TUS DATOS REALES
        const currentConfig = {
            PUBLIC_KEY: "svoVJvVfVFs5kcSDl",
            SERVICE_ID: "service_g6eersq", 
            TEMPLATE_ID: "template_tcuw0sr"
        };

        let emailjsReady = false;

        // INICIALIZAR EMAILJS
        function initializeEmailJS() {
            if (!currentConfig.PUBLIC_KEY) {
                console.error("❌ Public Key no configurada");
                showError("Configuración de EmailJS incompleta.");
                return false;
            }
            
            try {
                emailjs.init(currentConfig.PUBLIC_KEY);
                emailjsReady = true;
                console.log("✅ EmailJS inicializado correctamente");
                return true;
            } catch (error) {
                console.error("❌ Error inicializando EmailJS:", error);
                showError("Error al inicializar el servicio de email.");
                return false;
            }
        }

        // VERIFICAR CONFIGURACIÓN
        function testEmailJSConfiguration() {
            const required = ['PUBLIC_KEY', 'SERVICE_ID', 'TEMPLATE_ID'];
            const missing = required.filter(key => !currentConfig[key]);
            
            if (missing.length > 0) {
                console.error("❌ Configuración faltante:", missing);
                showError("Configuración de EmailJS incompleta. Verifica los IDs.");
                return false;
            }
            
            console.log("✅ Configuración EmailJS verificada");
            console.log("🔑 Public Key:", currentConfig.PUBLIC_KEY);
            console.log("🏢 Service ID:", currentConfig.SERVICE_ID);
            console.log("📄 Template ID:", currentConfig.TEMPLATE_ID);
            return true;
        }

        // CUANDO LA PÁGINA CARGUE
        document.addEventListener('DOMContentLoaded', function() {
            console.log("✅ Página cargada - Centro Psicológico de Especialidades");
            
            // Verificar configuración primero
            if (!testEmailJSConfiguration()) {
                return;
            }
            
            // Configurar componentes
            setupFormHandler();
            setupSmoothScrolling();
            
            // Inicializar EmailJS
            if (!initializeEmailJS()) {
                showConfigurationInstructions();
            }
        });

        // CONFIGURAR FORMULARIO
        function setupFormHandler() {
            const contactForm = document.getElementById('contactForm');
            if (contactForm) {
                contactForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    handleFormSubmit(this);
                });
                console.log("✅ Formulario configurado");
            }
        }

        // MANEJAR ENVÍO DEL FORMULARIO
        function handleFormSubmit(form) {
            console.log("📝 Procesando solicitud de cita...");
            
            if (!validateForm()) {
                return;
            }
            
            if (!emailjsReady) {
                showError("⚠️ El servicio de email no está listo. Recargue la página.");
                return;
            }
            
            // Preparar datos para el email
            const formData = {
                from_name: document.getElementById('name').value.trim(),
                from_email: document.getElementById('email').value.trim(),
                phone: document.getElementById('phone').value.trim(),
                service: document.getElementById('service').value,
                message: document.getElementById('message').value.trim(),
                date: new Date().toLocaleString('es-EC'),
                to_email: "williamfernando1981@gmail.com",
                subject: "Nueva Cita - Centro Psicológico"
            };
            
            console.log("📤 Enviando datos a EmailJS...", formData);
            
            // Mostrar estado de carga
            const submitBtn = form.querySelector('.submit-btn');
            const originalText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ENVIANDO SOLICITUD...';
            
            hideAllMessages();
            
            // ENVIAR EMAIL CON EMAILJS
            emailjs.send(currentConfig.SERVICE_ID, currentConfig.TEMPLATE_ID, formData)
                .then(function(response) {
                    console.log("✅ ÉXITO - Email enviado:", response);
                    showSuccess();
                    form.reset();
                    
                    // Mostrar información en consola para WhatsApp
                    mostrarInfoWhatsApp(formData);
                    
                })
                .catch(function(error) {
                    console.error("❌ ERROR EmailJS:", error);
                    
                    let errorMsg = "No se pudo enviar la solicitud. ";
                    
                    if (error?.status === 400) {
                        errorMsg += "Error en la configuración. Verifica Service ID y Template ID.";
                    } else if (error?.status === 401) {
                        errorMsg += "Error de autenticación. Verifica tu Public Key.";
                    } else if (error?.status === 429) {
                        errorMsg += "Límite de envíos excedido. Intenta más tarde.";
                    } else {
                        errorMsg += "Por favor, contáctanos directamente por WhatsApp.";
                    }
                    
                    showError(errorMsg);
                })
                .finally(function() {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalText;
                });
        }

        // MOSTRAR INFORMACIÓN PARA WHATSAPP EN CONSOLA
        function mostrarInfoWhatsApp(formData) {
            const mensajeWhatsApp = `🚨 *NUEVA SOLICITUD DE CITA* 🚨

*👤 PACIENTE:* ${formData.from_name}
*📧 EMAIL:* ${formData.from_email}
*📞 TELÉFONO:* ${formData.phone}
*🎯 SERVICIO:* ${formData.service}
*⏰ FECHA SOLICITUD:* ${formData.date}

*💬 MOTIVO DE CONSULTA:*
${formData.message}

*📍 CENTRO PSICOLÓGICO DE ESPECIALIDADES*
*⚡ CONTACTAR DENTRO DE 24 HORAS*`;

            const telefonoWhatsApp = "593984001305";
            const mensajeCodificado = encodeURIComponent(mensajeWhatsApp);
            const enlaceWhatsApp = `https://wa.me/${telefonoWhatsApp}?text=${mensajeCodificado}`;
            
            console.log("📲 ===== INFORMACIÓN PARA WHATSAPP =====");
            console.log("🔗 Enlace directo para notificar:");
            console.log(enlaceWhatsApp);
            console.log("📝 Mensaje para copiar:");
            console.log(mensajeWhatsApp);
            console.log("=========================================");
        }

        // MOSTRAR INSTRUCCIONES DE CONFIGURACIÓN
        function showConfigurationInstructions() {
            const instructions = `
🔧 CONFIGURACIÓN EMAILJS - VERIFICAR

Datos actuales:
• Public Key: ${currentConfig.PUBLIC_KEY}
• Service ID: ${currentConfig.SERVICE_ID}  
• Template ID: ${currentConfig.TEMPLATE_ID}

Si el formulario no funciona:
1. Verifica que los IDs sean correctos en EmailJS
2. Confirma que el template esté publicado
3. Revisa que el servicio de email esté conectado
            `;
            
            console.warn(instructions);
        }

        // VALIDACIÓN DEL FORMULARIO
        function validateForm() {
            const fields = {
                name: document.getElementById('name'),
                email: document.getElementById('email'),
                phone: document.getElementById('phone'),
                service: document.getElementById('service'),
                message: document.getElementById('message')
            };
            
            // Limpiar estilos de error
            Object.values(fields).forEach(field => {
                if (field) field.style.borderColor = '';
            });
            
            let isValid = true;
            let errorMessage = "";
            
            if (!fields.name.value.trim()) {
                fields.name.style.borderColor = '#dc2626';
                errorMessage = "Por favor ingresa tu nombre completo";
                isValid = false;
            }
            else if (!fields.email.value.trim()) {
                fields.email.style.borderColor = '#dc2626';
                errorMessage = "Por favor ingresa tu email";
                isValid = false;
            }
            else if (!isValidEmail(fields.email.value.trim())) {
                fields.email.style.borderColor = '#dc2626';
                errorMessage = "Por favor ingresa un email válido";
                isValid = false;
            }
            else if (!fields.phone.value.trim()) {
                fields.phone.style.borderColor = '#dc2626';
                errorMessage = "Por favor ingresa tu teléfono";
                isValid = false;
            }
            else if (!fields.service.value) {
                fields.service.style.borderColor = '#dc2626';
                errorMessage = "Por favor selecciona un servicio";
                isValid = false;
            }
            else if (!fields.message.value.trim()) {
                fields.message.style.borderColor = '#dc2626';
                errorMessage = "Por favor ingresa tu mensaje o motivo de consulta";
                isValid = false;
            }
            
            if (!isValid) {
                showError(errorMessage);
            }
            
            return isValid;
        }

        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        function showSuccess() {
            const element = document.getElementById('confirmationMessage');
            if (element) {
                element.style.display = 'flex';
                element.innerHTML = `
                    <i class="fas fa-check-circle"></i>
                    <div>
                        <h4>¡Solicitud Enviada Exitosamente! ✅</h4>
                        <p>Hemos recibido tu solicitud de cita. Te contactaremos en menos de 24 horas.</p>
                        <div style="background: #e8f5e8; padding: 10px; border-radius: 5px; margin-top: 10px; font-size: 14px;">
                            <strong>📞 Teléfono de contacto:</strong> +593 98 400 1305<br>
                            <strong>📧 Email:</strong> williamfernando1981@gmail.com
                        </div>
                    </div>
                `;
                element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                setTimeout(() => element.style.display = 'none', 8000);
            }
        }

        function showError(message) {
            const element = document.getElementById('errorMessage');
            const textElement = document.getElementById('errorText');
            
            if (element && textElement) {
                textElement.textContent = message;
                element.style.display = 'flex';
                element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                setTimeout(() => element.style.display = 'none', 5000);
            }
        }

        function hideAllMessages() {
            const success = document.getElementById('confirmationMessage');
            const error = document.getElementById('errorMessage');
            if (success) success.style.display = 'none';
            if (error) error.style.display = 'none';
        }

        function setupSmoothScrolling() {
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                });
            });
        }

        // FUNCIÓN PARA DEBUG - VER ESTADO ACTUAL
        window.checkEmailStatus = function() {
            console.log("=== 🔍 ESTADO ACTUAL EMAILJS ===");
            console.log("✅ SDK Disponible:", typeof emailjs !== 'undefined');
            console.log("✅ Inicializado:", emailjsReady);
            console.log("🔑 Public Key:", currentConfig.PUBLIC_KEY);
            console.log("🏢 Service ID:", currentConfig.SERVICE_ID);
            console.log("📄 Template ID:", currentConfig.TEMPLATE_ID);
            console.log("================================");
        };

        // Mensaje de bienvenida en consola
        console.log('%c¡Centro Psicológico de Especialidades!', 'color: #b84a39; font-size: 16px; font-weight: bold;');
        console.log('%c✅ Errores solucionados - Sitio listo para producción', 'color: #25D366; font-weight: bold;');
        console.log('Usa checkEmailStatus() para ver el estado de EmailJS');
    </script>
</body>
</html>
